"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var http_errors_1 = __importDefault(require("http-errors"));
var _2019_js_1 = __importDefault(require("ajv/dist/2019.js"));
var ajv_i18n_1 = __importDefault(require("ajv-i18n"));
var ajv_formats_1 = __importDefault(require("ajv-formats"));
var ajv_formats_draft2019_1 = __importDefault(require("ajv-formats-draft2019"));
var jsonSafeParse = require('@serverless-devs/dk-util').jsonSafeParse;
var ajv;
var ajvDefaults = {
    strict: true,
    coerceTypes: 'array',
    allErrors: true,
    useDefaults: 'empty',
    messages: false, // allow i18n
};
var defaults = {
    eventSchema: null,
    bodySchema: null,
    urlSchema: null,
    outputSchema: null,
    ajvOptions: {},
    ajvInstance: undefined,
    defaultLanguage: 'en',
};
var validatorMiddleware = function (opts) {
    if (opts === void 0) { opts = {}; }
    var _a = __assign(__assign({}, defaults), opts), eventSchema = _a.eventSchema, bodySchema = _a.bodySchema, urlSchema = _a.urlSchema, outputSchema = _a.outputSchema, ajvOptions = _a.ajvOptions, ajvInstance = _a.ajvInstance, defaultLanguage = _a.defaultLanguage;
    var useSchemaForAll = function (schemaConfig) {
        if (schemaConfig)
            return Object.prototype.hasOwnProperty.call(schemaConfig, 'type');
        return false;
    };
    // TODO：请求 url post/list/ 能访问对应路由 post/list
    var getCorrespondingvalidSchema = function (request, schemaConfig) {
        var _a = request.req, method = _a.method, path = _a.path;
        var validSchema = null;
        for (var _i = 0, _b = Object.entries(schemaConfig); _i < _b.length; _i++) {
            var _c = _b[_i], key = _c[0], schema = _c[1];
            if (key.toLowerCase().replace(/\s+/g, "") === method.toLowerCase() + path.toLowerCase()) {
                try {
                    validSchema = compile(schema, ajvOptions, ajvInstance);
                }
                catch (err) {
                    throw new http_errors_1.default.InternalServerError("There may be a problem with the schema format, you can refer to the detailed error information: " + err);
                }
            }
        }
        return validSchema;
    };
    var validEventSchema = useSchemaForAll(eventSchema) ? compile(eventSchema, ajvOptions, ajvInstance) : null;
    var validBodySchema = useSchemaForAll(bodySchema) ? compile(bodySchema, ajvOptions, ajvInstance) : null;
    var validUrlSchema = useSchemaForAll(urlSchema) ? compile(urlSchema, ajvOptions, ajvInstance) : null;
    var validOutputSchema = useSchemaForAll(outputSchema) ? compile(outputSchema, ajvOptions, ajvInstance) : null;
    var validatorMiddlewareBefore = function (request) { return __awaiter(void 0, void 0, void 0, function () {
        var event, validEventSchemaTemp, validate, valid, error, language, validBodySchemaTemp, validate, valid, error, language, validUrlSchemaTemp, validate, valid, error, language;
        return __generator(this, function (_a) {
            event = Buffer.isBuffer(request.event)
                ? jsonSafeParse(request.event.toString())
                : request.event;
            if (event) {
                validEventSchemaTemp = null;
                if (!validEventSchema) {
                    validEventSchemaTemp = getCorrespondingvalidSchema(request, eventSchema);
                }
                // 没有找到匹配的就不校验
                if (!validEventSchema && !validEventSchemaTemp)
                    return [2 /*return*/];
                validate = validEventSchema || validEventSchemaTemp;
                valid = validate(event);
                if (!valid) {
                    error = new http_errors_1.default.BadRequest('Event object failed validation');
                    language = chooseLanguage(event, defaultLanguage);
                    ajv_i18n_1.default[language](validate.errors);
                    error.details = validate.errors;
                    throw error;
                }
            }
            else {
                // http函数
                // body
                if (bodySchema) {
                    validBodySchemaTemp = null;
                    if (!validBodySchema) {
                        validBodySchemaTemp = getCorrespondingvalidSchema(request, bodySchema);
                    }
                    if (!validBodySchema && !validBodySchemaTemp)
                        return [2 /*return*/];
                    validate = validBodySchema || validBodySchemaTemp;
                    valid = validate(request.req.body);
                    if (!valid) {
                        error = new http_errors_1.default.BadRequest('Body object failed validation');
                        language = chooseLanguage(request.req.body, defaultLanguage);
                        ajv_i18n_1.default[language](validate.errors);
                        error.details = validate.errors;
                        throw error;
                    }
                }
                // path和queries
                if (urlSchema) {
                    validUrlSchemaTemp = null;
                    if (!validUrlSchema) {
                        validUrlSchemaTemp = getCorrespondingvalidSchema(request, urlSchema);
                    }
                    if (!validUrlSchema && !validUrlSchemaTemp)
                        return [2 /*return*/];
                    validate = validUrlSchema || validUrlSchemaTemp;
                    valid = validate({ path: request.req.path, queries: request.req.queries });
                    if (!valid) {
                        error = new http_errors_1.default.BadRequest('Url object failed validation');
                        language = chooseLanguage(request.req.queries, defaultLanguage);
                        ajv_i18n_1.default[language](validate.errors);
                        error.details = validate.errors;
                        throw error;
                    }
                }
            }
            return [2 /*return*/];
        });
    }); };
    var validatorMiddlewareAfter = function (request) { return __awaiter(void 0, void 0, void 0, function () {
        var validOutputSchemaTemp, validate, valid, error;
        return __generator(this, function (_a) {
            validOutputSchemaTemp = null;
            if (!validOutputSchema) {
                validOutputSchemaTemp = getCorrespondingvalidSchema(request, outputSchema);
            }
            if (!validOutputSchema && !validOutputSchemaTemp)
                return [2 /*return*/];
            validate = validOutputSchema || validOutputSchemaTemp;
            valid = validate(request.result);
            if (!valid) {
                error = new http_errors_1.default.InternalServerError('Response object failed validation');
                error.details = validate.errors;
                error.response = request.result;
                throw error;
            }
            return [2 /*return*/];
        });
    }); };
    var usedInputSchema = eventSchema || bodySchema || urlSchema;
    var usedOutputSchema = outputSchema;
    return {
        before: usedInputSchema ? validatorMiddlewareBefore : null,
        after: usedOutputSchema ? validatorMiddlewareAfter : null,
    };
};
// This is pulled out due to it's performance cost (50-100ms on cold start)
// Precompile your schema during a build step is recommended.
var compile = function (schema, ajvOptions, ajvInstance) {
    if (ajvInstance === void 0) { ajvInstance = null; }
    // Check if already compiled
    if (typeof schema === 'function' || !schema)
        return schema;
    var options = __assign(__assign({}, ajvDefaults), ajvOptions);
    if (!ajv) {
        ajv = ajvInstance !== null && ajvInstance !== void 0 ? ajvInstance : new _2019_js_1.default(options);
        ajv_formats_1.default(ajv);
        ajv_formats_draft2019_1.default(ajv);
    }
    return ajv.compile(schema);
};
/* in ajv-i18n Portuguese is represented as pt-BR */
var languageNormalizationMap = {
    pt: 'pt-BR',
    'pt-br': 'pt-BR',
    pt_BR: 'pt-BR',
    pt_br: 'pt-BR',
    zh: 'zh-TW',
    'zh-tw': 'zh-TW',
    zh_TW: 'zh-TW',
    zh_tw: 'zh-TW',
};
var normalizePreferredLanguage = function (lang) { var _a; return (_a = languageNormalizationMap[lang]) !== null && _a !== void 0 ? _a : lang; };
var availableLanguages = Object.keys(ajv_i18n_1.default);
var chooseLanguage = function (_a, defaultLanguage) {
    var preferredLanguage = _a.preferredLanguage;
    if (preferredLanguage) {
        var lang = normalizePreferredLanguage(preferredLanguage);
        if (availableLanguages.includes(lang)) {
            return lang;
        }
    }
    return defaultLanguage;
};
module.exports = validatorMiddleware;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNERBQXNDO0FBQ3RDLDhEQUFtQztBQUNuQyxzREFBZ0M7QUFDaEMsNERBQWtDO0FBQ2xDLGdGQUFxRDtBQUU3QyxJQUFBLGFBQWEsR0FBSyxPQUFPLENBQUMsMEJBQTBCLENBQUMsY0FBeEMsQ0FBeUM7QUFFOUQsSUFBSSxHQUFHLENBQUM7QUFDUixJQUFNLFdBQVcsR0FBRztJQUNsQixNQUFNLEVBQUUsSUFBSTtJQUNaLFdBQVcsRUFBRSxPQUFPO0lBQ3BCLFNBQVMsRUFBRSxJQUFJO0lBQ2YsV0FBVyxFQUFFLE9BQU87SUFDcEIsUUFBUSxFQUFFLEtBQUssRUFBRSxhQUFhO0NBQy9CLENBQUM7QUFFRixJQUFNLFFBQVEsR0FBRztJQUNmLFdBQVcsRUFBRSxJQUFJO0lBQ2pCLFVBQVUsRUFBRSxJQUFJO0lBQ2hCLFNBQVMsRUFBRSxJQUFJO0lBQ2YsWUFBWSxFQUFFLElBQUk7SUFDbEIsVUFBVSxFQUFFLEVBQUU7SUFDZCxXQUFXLEVBQUUsU0FBUztJQUN0QixlQUFlLEVBQUUsSUFBSTtDQUN0QixDQUFDO0FBRUYsSUFBTSxtQkFBbUIsR0FBRyxVQUFDLElBQVM7SUFBVCxxQkFBQSxFQUFBLFNBQVM7SUFDOUIsSUFBQSwyQkFTRCxRQUFRLEdBQ1IsSUFBSSxDQUNSLEVBVkMsV0FBVyxpQkFBQSxFQUNYLFVBQVUsZ0JBQUEsRUFDVixTQUFTLGVBQUEsRUFDVCxZQUFZLGtCQUFBLEVBQ1osVUFBVSxnQkFBQSxFQUNWLFdBQVcsaUJBQUEsRUFDWCxlQUFlLHFCQUloQixDQUFDO0lBRUYsSUFBTSxlQUFlLEdBQUcsVUFBQyxZQUFZO1FBQ25DLElBQUcsWUFBWTtZQUFFLE9BQU8sTUFBTSxDQUFDLFNBQVMsQ0FBQyxjQUFjLENB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